<!DOCTYPE html>
<html>
  <head>
    <style>
      body { font-family: sans-serif; padding: 16px; }
      label { display: block; margin: 8px 0; }
      button { margin-top: 16px; }
    </style>
  </head>
  <body>
    <h3>WÃ¤hle die Sections aus:</h3>
    <form id="sectionForm"></form>
    <button id="runBtn">Plugin starten</button>

    <div id="result"></div>
    <div id="errors" style="color: red; margin-top: 1em;"></div>

    <script>
      const form = document.getElementById('sectionForm');
      const runBtn = document.getElementById('runBtn');

      window.onmessage = (event) => {
        const msg = event.data.pluginMessage;
        if (msg.type === 'init') {
          msg.sections.forEach(section => {
            const label = document.createElement('label');
            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.value = section.id;
            label.appendChild(checkbox);
            label.appendChild(document.createTextNode(" " + section.name));
            form.appendChild(label);
          });
        }
      };

      runBtn.onclick = () => {
        const selected = Array.from(form.querySelectorAll('input[type="checkbox"]:checked'))
          .map(cb => cb.value);

        parent.postMessage({
          pluginMessage: {
            type: 'run-plugin',
            selectedSectionIds: selected
          }
        }, '*');
      };
    </script>
  </body>
</html>
